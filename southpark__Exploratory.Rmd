---
title: "South Park Exploratory Analysis"
author: "kwalker"
date: "January 27, 2016"
output: html_document
---

```{r opts, warning=FALSE, message=FALSE, echo=FALSE}
library(knitr)
library(stringr)
library(ggplot2)
library(RColorBrewer)
library(ggrepel)
opts_chunk$set(cache=TRUE, fig.width=10, fig.height=8, echo=FALSE)
```


```{r}
#setwd("/Users/kaylinwalker/R/textmining_southpark/scripts")
#source("01_southpark_scrape.R") 
#source("02_southpark_corpus.R") 
#source("03_southpark_loglikelihood.R") 

setwd("/Users/kaylinwalker/R/textmining_southpark/tidy data")
ngrams <- read.csv("southpark_ngrams.csv", stringsAsFactors=FALSE)

main.speakers <- c("CARTMAN", "STAN", "KYLE", "KENNY", "RANDY", "BUTTERS", "MR..GARRISON")

ngrams <- ngrams[abs(ngrams$LL) >= 10.83, ] # 1073 / 21106 = 5%  // 1477/75552 = 1.9%
ngrams.main <- ngrams[ngrams$speaker %in% main.speakers, ] # 732/1477 = 49.5%

## remove redundant ngrams like "you guys" vs. "you guys i" and "guys you guys"
ngrams.norepeat <- ngrams[ngrams$ngram==1, ]
bi <- ngrams[ngrams$ngram == 2, ]
bi <- unique(bi$word)
for(h in seq_along(bi)) {
     for(s in main.speakers) {
          temp <- ngrams[grepl(bi[h], ngrams$word) & ngrams$speaker==s, ]
          if(length(temp[,1]) > 0 ) {
          temp <- temp[order(-temp$LL), ]          
          ngrams.norepeat <- rbind(ngrams.norepeat, temp[1,])
          }
     }
}
ngrams.norepeat <- unique(ngrams.norepeat)

ngrams.main <- ngrams.main[ngrams.main$speaker %in% c( "KENNY"), ]
ggplot(ngrams.main, aes(speaker, LL)) + 
     geom_point(color="white") + 
     geom_text_repel(aes(label=ngrams.main$word, fill=factor(speaker)),  
                     box.padding = unit(0.25, "lines")) + 
     scale_size(range=c(5,10)) +
     scale_color_brewer(palette="Paired") +
     theme_classic() + 
     theme(axis.text.x = element_text(angle = 20, hjust = 1), legend.position=1) + 
     labs(title="Most Characteristic Words & Phrases by Character") + 
     xlab("") + ylab("Log(Log Likelihood)") 

```



