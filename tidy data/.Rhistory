geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
plot <- ngrams.main[ngrams.main$LL > 0 , ]
rankbyspeaker <- function(df) {
rank <- NULL
speakers <- unique(df$speaker)
for(j in speakers) {
subset <- df[df$speaker==j,]
subset$rank <- subset$speaker.word*subset$LL*subset$ngram
if(length(subset[,1]) > 25) subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,]
subset <- subset[order(subset$rank), ]
row.names(subset) <- NULL
subset$rank2 <- as.numeric(row.names(subset))
rank <- rbind(rank, subset)
}
return(rank)
}
ranked <- rankbyspeaker(plot)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
View(ranked)
ngrams <- read.csv("southpark_ngrams.csv", stringsAsFactors=FALSE)
ngrams <- read.csv("southpark_ngrams.csv", stringsAsFactors=FALSE)
ngrams <- ngrams[abs(ngrams$LL) >= 10.83, ] # 1073 / 21106 = 5%  // 1477/75552 = 1.9%
ngrams.pos <- ngrams[ngrams$LL >= 0, ]
ngrams.neg <- ngrams[ngrams$LL < 0, ]
n.unique <- function(df){
ngrams.unique <- NULL
words <- unique(df$word)
for(h in seq_along(words)) {
subset <- df[df$word==words[h],]
if(length(subset[,1]) > 1) subset <- subset[order(-abs(subset$LL)), ]
ngrams.unique <- rbind(ngrams.unique, subset[1,])
}
return(ngrams.unique)
}
ngrams.unique <- rbind(n.unique(ngrams.pos),n.unique(ngrams.neg))
plot <- n.unique(ngrams.pos)
rankbyspeaker <- function(df) {
rank <- NULL
speakers <- unique(df$speaker)
for(j in speakers) {
subset <- df[df$speaker==j,]
subset$rank <- subset$speaker.word*subset$LL*subset$ngram
if(length(subset[,1]) > 25) subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,]
subset <- subset[order(subset$rank), ]
row.names(subset) <- NULL
subset$rank2 <- as.numeric(row.names(subset))
rank <- rbind(rank, subset)
}
return(rank)
}
ranked <- rankbyspeaker(plot)
View(ranked)
df <- plot
rank <- NULL
speakers <- unique(df$speaker)
j <- "SHARON"
subset <- df[df$speaker==j,]
subset$rank <- subset$speaker.word*subset$LL*subset$ngram
View(subset)
subset <- subset[order(subset$rank), ]
View(subset)
if(length(subset[,1]) > 25) subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,]
length(subset[,1])
length(subset[,1]) > 25
subset <- df[df$speaker==j,]
subset$rank <- subset$speaker.word*subset$LL*subset$ngram
if(length(subset[,1]) > 25) { subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,] }
plot <- n.unique(ngrams.pos)
rankbyspeaker <- function(df) {
rank <- NULL
speakers <- unique(df$speaker)
for(j in speakers) {
subset <- df[df$speaker==j,]
subset$rank <- subset$speaker.word*subset$LL*subset$ngram
if(length(subset[,1]) > 25) { subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(subset$rank), ]
row.names(subset) <- NULL
subset$rank2 <- as.numeric(row.names(subset))
rank <- rbind(rank, subset)
}
return(rank)
}
ranked <- rankbyspeaker(plot)
View(ranked)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
#scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
main.speakers <- c("CARTMAN", "STAN", "KYLE", "KENNY", "RANDY", "BUTTERS", "MR..GARRISON", "MS..CARTMAN", "SHARON")
plot <- ngrams.main[ngrams$speaker %in% main.speakers & ngrams.main$LL > 0 , ]
plot <- ngrams.unique[ngrams.unique$speaker %in% main.speakers & ngrams.unique$LL > 0 , ]
ranked <- rankbyspeaker(plot)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
#scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
main.speakers <- c("CARTMAN", "STAN", "KYLE", "KENNY", "RANDY", "BUTTERS", "MR..GARRISON", "MS..CARTMAN")
plot <- ngrams.unique[ngrams.unique$speaker %in% main.speakers & ngrams.unique$LL > 0 , ]
ranked <- rankbyspeaker(plot)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
## remove redundant ngrams like "you guys" vs. "you guys i" and "guys you guys"
ngrams.norepeat <- ngrams.unique[ngrams.unique$ngram==1, ]
bi <- ngrams.unique[ngrams.unique$ngram == 2, ]
bi <- unique(bi$word)
for(h in seq_along(bi)) {
for(s in main.speakers) {
temp <- ngrams.unique[grepl(bi[h], ngrams.unique$word) & ngrams.unique$speaker==s, ]
if(length(temp[,1]) > 0 ) {
temp <- temp[order(-temp$LL), ]
ngrams.norepeat <- rbind(ngrams.norepeat, temp[1,])
}
}
}
ngrams.norepeat <- unique(ngrams.norepeat)
ngrams.main <- ngrams.norepeat [ngrams.norepeat $speaker %in% main.speakers, ] # 542/1101 = 49.2%
plot <- ngrams.main[ngrams.main$speaker %in% main.speakers & ngrams.main$LL > 0 , ]
ranked <- rankbyspeaker(plot)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
setwd("/Users/kwalker/git_projects/textmining_southpark/tidy data")
#setwd("/Users/kaylinwalker/R/textmining_southpark/tidy data")
ngrams <- read.csv("southpark_ngrams.csv", stringsAsFactors=FALSE)
main.speakers <- c("CARTMAN", "STAN", "KYLE", "KENNY", "RANDY", "BUTTERS", "MR..GARRISON", "MS..CARTMAN")
# for each ngram, keep only the highest and lowest LL
ngrams <- ngrams[abs(ngrams$LL) >= 10.83, ] # 1073 / 21106 = 5%  // 1477/75552 = 1.9%
ngrams.pos <- ngrams[ngrams$LL >= 0, ]
ngrams.neg <- ngrams[ngrams$LL < 0, ]
n.unique <- function(df){
ngrams.unique <- NULL
words <- unique(df$word)
for(h in seq_along(words)) {
subset <- df[df$word==words[h],]
if(length(subset[,1]) > 1) subset <- subset[order(-abs(subset$LL)), ]
ngrams.unique <- rbind(ngrams.unique, subset[1,])
}
return(ngrams.unique)
}
ngrams.unique <- rbind(n.unique(ngrams.pos),n.unique(ngrams.neg))
setwd("/Users/kwalker/git_projects/textmining_southpark/tidy data")
#setwd("/Users/kaylinwalker/R/textmining_southpark/tidy data")
ngrams <- read.csv("southpark_ngrams.csv", stringsAsFactors=FALSE)
main.speakers <- c("CARTMAN", "STAN", "KYLE", "KENNY", "RANDY", "BUTTERS", "MR..GARRISON", "MS..CARTMAN")
# for each ngram, keep only the highest and lowest LL
ngrams <- ngrams[abs(ngrams$LL) >= 10.83, ] # 1073 / 21106 = 5%  // 1477/75552 = 1.9%
n.unique <- function(df){
ngrams.unique <- NULL
words <- unique(df$word)
for(h in seq_along(words)) {
subset <- df[df$word==words[h],]
if(length(subset[,1]) > 1) subset <- subset[order(-abs(subset$LL)), ]
ngrams.unique <- rbind(ngrams.unique, subset[1,])
}
return(ngrams.unique)
}
ngrams.unique <- rbind(n.unique(ngrams[ngrams$LL >= 0, ]),
n.unique(ngrams[ngrams$LL < 0, ]))
ngrams.norepeat <- ngrams.unique[ngrams.unique$ngram==1, ]
bi <- ngrams.unique[ngrams.unique$ngram == 2, ]
bi <- unique(bi$word)
bi <- ngrams.unique[ngrams.unique$ngram == 2, ]
bi <- unique(bi$word)
h <-1
s <- "BUTTERS"
temp <- ngrams.unique[grepl(bi[h], ngrams.unique$word) & ngrams.unique$speaker==s, ]
s <- "CARTMAN"
temp <- ngrams.unique[grepl(bi[h], ngrams.unique$word) & ngrams.unique$speaker==s, ]
View(temp)
temp <- temp[order(-temp$LL), ]
View(temp)
source('~/.active-rstudio-document', echo=TRUE)
View(ranked)
rank <- NULL
df <- plot
j <- "CARTMAN"
speakers <- unique(df$speaker)
subset <- df[df$speaker==j,]
subset$rank <- subset$speaker.word*subset$LL*subset$ngram
View(subset)
subset <- subset[order(subset$rank), ]
View(subset)
rankbyspeaker <- function(df) {
rank <- NULL
speakers <- unique(df$speaker)
for(j in speakers) {
subset <- df[df$speaker==j,]
subset$rank <- subset$speaker.word*subset$LL*subset$ngram
#if(length(subset[,1]) > 25) { subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(subset$rank), ]
row.names(subset) <- NULL
subset$rank2 <- as.numeric(row.names(subset))
rank <- rbind(rank, subset)
}
return(rank)
}
ranked <- rankbyspeaker(plot)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
View(ranked)
direction <- "low"
subset <- df[df$speaker==j,]
subset$rank <- subset$speaker.word*subset$LL*subset$ngram
if(length(subset[,1]) > 25) { subset <- subset[order(subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(-subset$rank)
View(subset)
subset <- subset[order(-subset$rank),]
View(subset)
rankbyspeaker <- function(df, direction) {
rank <- NULL
speakers <- unique(df$speaker)
for(j in speakers) {
subset <- df[df$speaker==j,]
subset$rank <- subset$speaker.word*subset$LL*subset$ngram
if(direction="high") {
if(length(subset[,1]) > 25) { subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(subset$rank),]
} else if(direction="low") {
if(length(subset[,1]) > 25) { subset <- subset[order(subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(-subset$rank),]
}
row.names(subset) <- NULL
subset$rank2 <- as.numeric(row.names(subset))
rank <- rbind(rank, subset)
}
return(rank)
}
ranked <- rankbyspeaker(plot, "high")
View(ranked)
rankbyspeaker <- function(df, direction) {
rank <- NULL
speakers <- unique(df$speaker)
for(j in speakers) {
subset <- df[df$speaker==j,]
subset$rank <- subset$speaker.word*subset$LL*subset$ngram
if(direction=="high") {
if(length(subset[,1]) > 25) { subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(subset$rank),]
} else if(direction=="low") {
if(length(subset[,1]) > 25) { subset <- subset[order(subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(-subset$rank),]
}
row.names(subset) <- NULL
subset$rank2 <- as.numeric(row.names(subset))
rank <- rbind(rank, subset)
}
return(rank)
}
ranked <- rankbyspeaker(plot, "high")
View(ranked)
ranked2 <- rankbyspeaker(plot, "low")
ggplot(ranked2, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked2$word,fill=ranked2$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Least Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
View(ranked2)
plot <- ngrams.unique [ngrams.unique $speaker %in% main.speakers, ]
rankbyspeaker <- function(df, direction) {
rank <- NULL
speakers <- unique(df$speaker)
for(j in speakers) {
subset <- df[df$speaker==j,]
subset$rank <- subset$speaker.word*subset$LL*subset$ngram
if(length(subset[,1]) > 25) { subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(subset$rank),]
row.names(subset) <- NULL
subset$rank2 <- as.numeric(row.names(subset))
rank <- rbind(rank, subset)
}
return(rank)
}
ranked <- rankbyspeaker(plot)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
rankbyspeaker <- function(df, direction) {
rank <- NULL
speakers <- unique(df$speaker)
for(j in speakers) {
subset <- df[df$speaker==j,]
subset$rank <- subset$LL*subset$ngram
if(length(subset[,1]) > 25) { subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(subset$rank),]
row.names(subset) <- NULL
subset$rank2 <- as.numeric(row.names(subset))
rank <- rbind(rank, subset)
}
return(rank)
}
ranked <- rankbyspeaker(plot)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
rankbyspeaker <- function(df, direction) {
rank <- NULL
speakers <- unique(df$speaker)
for(j in speakers) {
subset <- df[df$speaker==j,]
subset$rank <- subset$LL
if(length(subset[,1]) > 25) { subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(subset$rank),]
row.names(subset) <- NULL
subset$rank2 <- as.numeric(row.names(subset))
rank <- rbind(rank, subset)
}
return(rank)
}
ranked <- rankbyspeaker(plot)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
rankbyspeaker <- function(df, direction) {
rank <- NULL
speakers <- unique(df$speaker)
for(j in speakers) {
subset <- df[df$speaker==j,]
subset$rank <- subset$LL*(subset$ngram/10)
if(length(subset[,1]) > 25) { subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(subset$rank),]
row.names(subset) <- NULL
subset$rank2 <- as.numeric(row.names(subset))
rank <- rbind(rank, subset)
}
return(rank)
}
ranked <- rankbyspeaker(plot)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
View(ranked)
rankbyspeaker <- function(df, direction) {
rank <- NULL
speakers <- unique(df$speaker)
for(j in speakers) {
subset <- df[df$speaker==j,]
subset$rank <- subset$LL*(subset$ngram*.25)
if(length(subset[,1]) > 25) { subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(subset$rank),]
row.names(subset) <- NULL
subset$rank2 <- as.numeric(row.names(subset))
rank <- rbind(rank, subset)
}
return(rank)
}
ranked <- rankbyspeaker(plot)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
rankbyspeaker <- function(df, direction) {
rank <- NULL
speakers <- unique(df$speaker)
for(j in speakers) {
subset <- df[df$speaker==j,]
subset$rank <- subset$LL
if(length(subset[,1]) > 25) { subset <- subset[order(-subset$rank), ]; subset <- subset[1:25,] }
subset <- subset[order(subset$rank),]
row.names(subset) <- NULL
subset$rank2 <- as.numeric(row.names(subset))
rank <- rbind(rank, subset)
}
return(rank)
}
ranked <- rankbyspeaker(plot)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranked Log Likelihood")
View(ranked)
setwd("Users/kwalker/Desktop")
setwd("/Users/kwalker/Desktop")
write.csv(ranked, "Ranked.csv", row.names=FALSE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranking") +
scale_x_continuous(limit = c(5,20), labels = c("Characteristic", "Most Characteristic"))
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranking")
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranking")  +
scale_y_continuous(limit = c(5,20), labels = c("Characteristic", "Most Characteristic"))
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranking")  +
scale_y_continuous(breaks = c(5,20), labels = c("Characteristic", "Most Characteristic"))
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranking")  +
scale_y_continuous(breaks = c(5,20), labels = c("High", "Highest"))
ggplot(ranked, aes(speaker, rank2)) +
geom_point(color="white") +
geom_label(aes(label=ranked$word,fill=ranked$speaker), color='white', fontface='bold') +
scale_fill_brewer(palette="Paired") +
theme_classic() +
theme(legend.position=1) +
labs(title="Most Characteristic Words & Phrases by Character") +
xlab("") + ylab("Ranking")  +
scale_y_continuous(breaks = c(25), labels = c("Highest"))
